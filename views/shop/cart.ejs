<%- include('../includes/header.ejs') %> 
<%- include('../includes/navigation.ejs') %>
<link rel="stylesheet" href="/css/product.css" />
<link rel="stylesheet" href="/css/main.css" />

<h1>Shopping Carts</h1>

<div class="product">
  <% if (cartItems.length === 0) { %>
    <h3>Your cart is empty.</h3>
  <% } else { %>
    <ul>
        <% let totalPrice = 0; %>
        <% cartItems.forEach(cartItem => {
          const product = formattedProduct.find(product => product.id === cartItem.productId);
          const itemTotalPrice = product.price * cartItem.quantity;
          totalPrice += itemTotalPrice;
        %>
          <div class="cart-item">
            <div class="cart-item-details">
              <img src="<%= product.imageUrl %>" alt="Product Image" />
              <div class="product-info">
                <h1 class="product-title"><%= product.title %></h1>
                <p class="product-price"><%= product.price %> USD each</p>
                <form action="/cart/update/<%= cartItem.id %>" method="POST">
                  <input type="number" value="<%= cartItem.quantity %>" name="quantity">
                </form>
                <form action="/cart/remove/<%= cartItem.id %>" method="POST">
                  <button>Remove</button>
                </form>
                <p>Total Price: <%= itemTotalPrice %> USD</p>
              </div>
              <div class="cart-item-actions">
              </div>
            </div>
          </div>
        <% }); %>
        <h2 class="total-cart-price">Total Price for all Items: <%= totalPrice %> USD</h2>
        <form action="/shop/orders" method="POST">
            <button class="primary-button">Order</button>
        </form>
      </ul>
            
  <% } %>
</div>

<%- include('../includes/footer.ejs') %>
